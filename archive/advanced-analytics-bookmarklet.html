<!DOCTYPE html>
<html>
<head>
    <title>NYT TPL Highlighter - Advanced Analytics Edition</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; line-height: 1.6; }
        .bookmarklet { 
            background: #f0f0f0; 
            padding: 20px; 
            border-radius: 8px; 
            margin: 20px 0;
            border: 2px dashed #326891;
        }
        .bookmarklet a {
            background: #326891;
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 6px;
            font-weight: bold;
            font-size: 16px;
            display: inline-block;
            margin: 10px 0;
        }
        .bookmarklet a:hover { background: #2d5a82; }
        .feature-highlight { background: #e8f4f8; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #326891; }
        .code { font-family: monospace; background: #f5f5f5; padding: 2px 6px; border-radius: 3px; }
        .new-feature { background: #d1fae5; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #10b981; }
    </style>
</head>
<body>
    <h1>üîç NYT TPL Highlighter - Advanced Analytics Edition</h1>
    
    <div class="new-feature">
        <h2>üÜï New Features Added</h2>
        <ul>
            <li><strong>Detailed "Other" Category Breakdown</strong> - Shows exactly what <code>tpl-lbl</code> and other uncategorized tokens are</li>
            <li><strong>Screen Real Estate Analysis</strong> - Calculates percentage of page area covered by TPL components</li>
            <li><strong>Component Size Distribution</strong> - Shows which components take up the most space</li>
            <li><strong>Viewport Coverage Metrics</strong> - Analyzes visible vs total page coverage</li>
        </ul>
    </div>

    <div class="bookmarklet">
        <h3>üöÄ Advanced TPL Analytics - Drag to Bookmarks:</h3>
        <p><strong>Instructions:</strong> Drag the link below to your bookmarks bar, then click it on any nytimes.com page!</p>
        <a href="javascript:void(0)" onclick="alert('Drag this link to your bookmarks bar instead of clicking it!')" style="cursor: move;">üéØ Advanced TPL Analyzer</a>
        
        <div style="background: #fff3cd; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #ffc107;">
            <h4>üìã Copy This Bookmarklet Code:</h4>
            <p>If dragging doesn't work, create a new bookmark and paste this as the URL:</p>
            <textarea readonly style="width: 100%; height: 120px; font-family: monospace; font-size: 11px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" onclick="this.select()">javascript:(function(){if(window.tplAdvancedAnalyzer){window.tplAdvancedAnalyzer.toggle();return;}var css='.tpl-highlighted{outline:2px solid #ff6b35!important;outline-offset:2px!important;position:relative!important;background:rgba(255,107,53,0.1)!important;transition:all 0.2s ease!important;cursor:pointer!important;}.tpl-highlighted:hover{outline-width:3px!important;background:rgba(255,107,53,0.2)!important;transform:scale(1.01)!important;}.tpl-badge{position:absolute!important;background:#ff6b35!important;color:white!important;font-family:monospace!important;font-size:8px!important;font-weight:600!important;padding:2px 5px!important;border-radius:3px!important;z-index:10000!important;pointer-events:none!important;white-space:nowrap!important;box-shadow:0 2px 4px rgba(0,0,0,0.2)!important;max-width:150px!important;overflow:hidden!important;text-overflow:ellipsis!important;}.tpl-tooltip{position:absolute!important;background:#1f2937!important;color:white!important;font-family:sans-serif!important;font-size:11px!important;padding:10px 12px!important;border-radius:6px!important;z-index:10001!important;max-width:350px!important;box-shadow:0 4px 12px rgba(0,0,0,0.3)!important;line-height:1.4!important;}.tpl-analytics-panel{position:fixed!important;top:20px!important;right:20px!important;width:350px!important;background:white!important;border:1px solid #ddd!important;border-radius:8px!important;box-shadow:0 4px 12px rgba(0,0,0,0.15)!important;z-index:10002!important;font-family:sans-serif!important;font-size:11px!important;max-height:85vh!important;overflow-y:auto!important;}.tpl-panel-header{background:#326891!important;color:white!important;padding:12px!important;font-weight:bold!important;border-radius:8px 8px 0 0!important;font-size:12px!important;}.tpl-panel-content{padding:15px!important;}.tpl-category{margin:8px 0!important;padding:10px!important;background:#f8f9fa!important;border-radius:4px!important;}.tpl-category-title{font-weight:bold!important;color:#326891!important;margin-bottom:6px!important;font-size:12px!important;}.tpl-token{font-family:monospace!important;font-size:9px!important;background:#e9ecef!important;padding:2px 4px!important;margin:1px!important;border-radius:2px!important;display:inline-block!important;}.tpl-close{float:right!important;cursor:pointer!important;font-size:18px!important;font-weight:bold!important;}.tpl-metrics{background:#fff3cd!important;padding:8px!important;border-radius:4px!important;margin:8px 0!important;border-left:3px solid #ffc107!important;}.tpl-other-detail{background:#e3f2fd!important;padding:8px!important;border-radius:4px!important;margin:5px 0!important;}';var style=document.createElement('style');style.textContent=css;document.head.appendChild(style);class TPLAdvancedAnalyzer{constructor(){this.isActive=false;this.tplElements=[];this.analytics={};this.areaAnalytics={};this.panel=null;}categorizeTPLClass(className){if(className.includes('text')||className.includes('typography')||className.includes('font')||className.includes('heading')||className.includes('body')||className.includes('title'))return 'Typography';if(className.includes('button')||className.includes('btn')||className.includes('link')||className.includes('cta'))return 'Interactive';if(className.includes('grid')||className.includes('container')||className.includes('layout')||className.includes('spacing')||className.includes('margin')||className.includes('padding')||className.includes('flex'))return 'Layout';if(className.includes('color')||className.includes('bg')||className.includes('theme')||className.includes('brand'))return 'Theme';if(className.includes('nav')||className.includes('header')||className.includes('footer')||className.includes('menu'))return 'Navigation';if(className.includes('card')||className.includes('modal')||className.includes('dropdown')||className.includes('tooltip'))return 'Components';return 'Other';}calculateElementArea(element){const rect=element.getBoundingClientRect();return rect.width*rect.height;}calculatePageMetrics(){const documentHeight=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight);const documentWidth=Math.max(document.body.scrollWidth,document.body.offsetWidth,document.documentElement.clientWidth,document.documentElement.scrollWidth,document.documentElement.offsetWidth);const totalPageArea=documentHeight*documentWidth;const viewportArea=window.innerWidth*window.innerHeight;return{totalPageArea,viewportArea,documentHeight,documentWidth};}analyzeTPLUsage(){this.analytics={Typography:new Set(),Interactive:new Set(),Layout:new Set(),Theme:new Set(),Navigation:new Set(),Components:new Set(),Other:new Set()};this.areaAnalytics={totalTPLArea:0,categoryAreas:{Typography:0,Interactive:0,Layout:0,Theme:0,Navigation:0,Components:0,Other:0},elementDetails:[]};const pageMetrics=this.calculatePageMetrics();this.tplElements.forEach(item=>{const area=this.calculateElementArea(item.element);this.areaAnalytics.totalTPLArea+=area;item.classes.forEach(cls=>{const category=this.categorizeTPLClass(cls);this.analytics[category].add(cls);this.areaAnalytics.categoryAreas[category]+=area/item.classes.length;});this.areaAnalytics.elementDetails.push({element:item.element,classes:item.classes,area:area,category:this.categorizeTPLClass(item.classes[0])});});this.areaAnalytics.pageMetrics=pageMetrics;this.areaAnalytics.tplCoveragePercent=(this.areaAnalytics.totalTPLArea/pageMetrics.totalPageArea*100).toFixed(2);this.areaAnalytics.viewportCoveragePercent=(this.areaAnalytics.totalTPLArea/pageMetrics.viewportArea*100).toFixed(2);}getOtherCategoryDetails(){const otherTokens=Array.from(this.analytics.Other);const tokenAnalysis=otherTokens.map(token=>{let interpretation='Unknown component';if(token.includes('lbl')||token.includes('label'))interpretation='Label/Text identifier';else if(token.includes('ico')||token.includes('icon'))interpretation='Icon component';else if(token.includes('img')||token.includes('image'))interpretation='Image component';else if(token.includes('meta')||token.includes('data'))interpretation='Metadata/Data display';else if(token.includes('tag')||token.includes('badge'))interpretation='Tag/Badge component';else if(token.includes('form')||token.includes('input'))interpretation='Form element';else if(token.includes('util')||token.includes('helper'))interpretation='Utility/Helper class';else if(token.includes('state')||token.includes('status'))interpretation='State indicator';return{token,interpretation};});return tokenAnalysis;}detectTPLElements(){const allElements=document.querySelectorAll('*');this.tplElements=[];allElements.forEach(element=>{const classes=element.className;if(typeof classes==='string'&&classes.includes('tpl')){const classArray=classes.split(' ');const tplClasses=classArray.filter(cls=>cls.startsWith('tpl')||cls.includes('tpl-'));if(tplClasses.length>0){this.tplElements.push({element:element,classes:tplClasses});}}});this.analyzeTPLUsage();console.log('Advanced TPL Analysis:',{totalElements:this.tplElements.length,areaAnalytics:this.areaAnalytics,categories:Object.fromEntries(Object.entries(this.analytics).map(([k,v])=>[k,Array.from(v)]))});return this.tplElements.length;}createAnalyticsPanel(){if(this.panel){this.panel.remove();}const otherDetails=this.getOtherCategoryDetails();const largestElements=this.areaAnalytics.elementDetails.sort((a,b)=>b.area-a.area).slice(0,5);this.panel=document.createElement('div');this.panel.className='tpl-analytics-panel';this.panel.innerHTML='<div class=\"tpl-panel-header\">Advanced TPL Analytics <span class=\"tpl-close\" onclick=\"this.parentElement.parentElement.remove()\">√ó</span></div><div class=\"tpl-panel-content\"><div class=\"tpl-metrics\"><strong>üìä Screen Real Estate Analysis</strong><br>‚Ä¢ Total TPL Coverage: <strong>'+this.areaAnalytics.tplCoveragePercent+'%</strong> of page<br>‚Ä¢ Viewport Coverage: <strong>'+this.areaAnalytics.viewportCoveragePercent+'%</strong> of visible area<br>‚Ä¢ Page Dimensions: '+this.areaAnalytics.pageMetrics.documentWidth+'√ó'+this.areaAnalytics.pageMetrics.documentHeight+'px<br>‚Ä¢ Total TPL Elements: <strong>'+this.tplElements.length+'</strong></div><div><strong>üèóÔ∏è Category Breakdown:</strong></div>'+Object.entries(this.analytics).map(([category,tokens])=>{const categoryArea=this.areaAnalytics.categoryAreas[category];const categoryPercent=(categoryArea/this.areaAnalytics.pageMetrics.totalPageArea*100).toFixed(1);return'<div class=\"tpl-category\"><div class=\"tpl-category-title\">'+category+' ('+tokens.size+' tokens, '+categoryPercent+'% area)</div>'+(category==='Other'?'<div class=\"tpl-other-detail\"><strong>üîç \"Other\" Category Analysis:</strong><br>'+otherDetails.map(({token,interpretation})=>'<div style=\"margin:3px 0;\"><code style=\"background:#fff;padding:1px 3px;\">'+token+'</code> ‚Üí '+interpretation+'</div>').join('')+'</div>':'')+Array.from(tokens).slice(0,8).map(token=>'<span class=\"tpl-token\">'+token+'</span>').join('')+(tokens.size>8?'<div style=\"font-size:9px;color:#666;margin-top:4px;\">+'+(tokens.size-8)+' more tokens</div>':'')+'</div>';}).join('')+'<div class=\"tpl-metrics\"><strong>üìè Largest TPL Components:</strong><br>'+largestElements.map((item,i)=>{const areaPercent=(item.area/this.areaAnalytics.pageMetrics.totalPageArea*100).toFixed(2);return(i+1)+'. '+item.category+': '+areaPercent+'% ('+item.classes[0]+')<br>';}).join('')+'</div><div style=\"margin-top:10px;padding-top:8px;border-top:1px solid #eee;font-size:9px;color:#666;\"><strong>üéØ System Insights:</strong><br>‚Ä¢ Token Diversity: '+Object.values(this.analytics).reduce((sum,set)=>sum+set.size,0)+' unique classes<br>‚Ä¢ Coverage Efficiency: '+this.getCoverageEfficiency()+'<br>‚Ä¢ Component Density: '+(this.tplElements.length/this.areaAnalytics.pageMetrics.totalPageArea*10000).toFixed(1)+' elements/10k px¬≤</div></div>';document.body.appendChild(this.panel);}getCoverageEfficiency(){const coverage=parseFloat(this.areaAnalytics.tplCoveragePercent);if(coverage>40)return 'High - TPL dominates page structure';if(coverage>20)return 'Medium - Good TPL adoption';if(coverage>10)return 'Growing - Moderate TPL usage';return 'Low - Limited TPL adoption';}activate(){if(this.isActive)return;this.isActive=true;this.tplElements.forEach((item,index)=>{const{element,classes}=item;element.classList.add('tpl-highlighted');const badge=document.createElement('div');badge.className='tpl-badge';const area=this.calculateElementArea(element);const areaPercent=(area/this.areaAnalytics.pageMetrics.totalPageArea*100).toFixed(2);badge.textContent=classes[0]+' ('+areaPercent+'%)';badge.setAttribute('data-tpl-index',index);const rect=element.getBoundingClientRect();badge.style.left=rect.left+window.scrollX+'px';badge.style.top=rect.top+window.scrollY-20+'px';document.body.appendChild(badge);element.addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();this.showElementDetails(element,classes,area);});});this.createAnalyticsPanel();}deactivate(){if(!this.isActive)return;this.isActive=false;this.tplElements.forEach(({element})=>{element.classList.remove('tpl-highlighted');});document.querySelectorAll('.tpl-badge').forEach(badge=>badge.remove());if(this.panel){this.panel.remove();this.panel=null;}}toggle(){if(this.isActive){this.deactivate();return 'deactivated';}else{const count=this.detectTPLElements();this.activate();return 'activated - found '+count+' TPL elements covering '+this.areaAnalytics.tplCoveragePercent+'% of page area';}}showElementDetails(element,classes,area){const tooltip=document.createElement('div');tooltip.className='tpl-tooltip';const categories=classes.map(cls=>this.categorizeTPLClass(cls));const areaPercent=(area/this.areaAnalytics.pageMetrics.totalPageArea*100).toFixed(3);const rect=element.getBoundingClientRect();tooltip.innerHTML='<strong>'+element.tagName+'</strong> ('+categories.join(', ')+')<br>TPL Classes: '+classes.join(', ')+'<br>Area: '+rect.width.toFixed(0)+'√ó'+rect.height.toFixed(0)+'px ('+areaPercent+'% of page)<br>Content: '+element.textContent.substring(0,60)+'...<br><em>See panel for full analysis</em>';tooltip.style.left=rect.left+window.scrollX+'px';tooltip.style.top=rect.bottom+window.scrollY+5+'px';document.body.appendChild(tooltip);setTimeout(()=>tooltip.remove(),5000);}}window.tplAdvancedAnalyzer=new TPLAdvancedAnalyzer();const result=window.tplAdvancedAnalyzer.toggle();alert('Advanced TPL Analyzer '+result+'!');})();</textarea>
            <button onclick="document.querySelector('textarea').select(); document.execCommand('copy'); alert('Bookmarklet code copied to clipboard!')" style="margin-top: 10px; padding: 8px 16px; background: #326891; color: white; border: none; border-radius: 4px; cursor: pointer;">üìã Copy Code</button>
        </div>
    </div>

    <div class="feature-highlight">
        <h2>üîç "Other" Category Deep Dive</h2>
        <p>The enhanced analyzer now provides detailed interpretation of unclear TPL tokens:</p>
        <ul>
            <li><strong><code>tpl-lbl</code></strong> ‚Üí Likely "TPL Label" - text labeling component</li>
            <li><strong><code>tpl-ico</code></strong> ‚Üí Icon components</li>
            <li><strong><code>tpl-meta</code></strong> ‚Üí Metadata/data display elements</li>
            <li><strong><code>tpl-util</code></strong> ‚Üí Utility/helper classes</li>
            <li><strong><code>tpl-state</code></strong> ‚Üí State indicators (active, disabled, etc.)</li>
        </ul>
    </div>

    <div class="feature-highlight">
        <h2>üìä Screen Real Estate Metrics</h2>
        <p>The new version calculates comprehensive area coverage:</p>
        <ul>
            <li><strong>Total Page Coverage:</strong> Percentage of entire page area covered by TPL components</li>
            <li><strong>Viewport Coverage:</strong> Percentage of visible screen area</li>
            <li><strong>Category Distribution:</strong> Which design system categories take up the most space</li>
            <li><strong>Component Efficiency:</strong> Largest components and their impact</li>
            <li><strong>Coverage Density:</strong> Elements per pixel area for system penetration analysis</li>
        </ul>
    </div>

    <div class="feature-highlight">
        <h2>üéØ Strategic Applications</h2>
        <ul>
            <li><strong>Design System ROI:</strong> Quantify actual page coverage by your design system</li>
            <li><strong>Adoption Metrics:</strong> Track TPL usage percentage across different page types</li>
            <li><strong>Component Performance:</strong> Identify which components dominate screen real estate</li>
            <li><strong>Legacy Migration:</strong> Measure progress in converting non-TPL elements</li>
            <li><strong>Mobile vs Desktop:</strong> Compare coverage efficiency across breakpoints</li>
        </ul>
    </div>
</body>
</html>
